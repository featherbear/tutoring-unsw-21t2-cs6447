<!doctype html><html lang=en><head><meta charset=utf-8><title>Week 2</title><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=stylesheet href=../reveal-js/css/reset.css><link rel=stylesheet href=../reveal-js/css/reveal.css><link rel=stylesheet href=../reveal-js/css/theme/black.css id=theme><link rel=stylesheet href=../highlight-js/default.min.css></head><body><div class=reveal><div class=slides><script defer type=application/javascript src=fuzz.js></script><style>.mono{font-family:monospace}.fuzzTarget{font-family:monospace}</style><section data-noprocess data-shortcode-slide class=center><h2 id=week-2>Week 2</h2><p><span class=mono>$></span> <span class=fuzzTarget>shellcode</span></p></section><section><h1 id=todays-agenda>Today&rsquo;s Agenda</h1><ul><li>Kahoot&rsquo;nt</li><li>Content Review<ul><li>Assembly Code</li><li>cdecl</li><li>Shellcode</li><li>Egg Hunters</li><li><code>/bin/////////sh</code></li><li><code>NOP</code> sleds</li></ul></li><li>Activities</li></ul></section><section><h1 id=kahootnt>Kahoot&rsquo;nt</h1><blockquote><p><a href=http://joinmyquiz.com>joinmyquiz.com</a></p></blockquote></section><section data-noprocess data-shortcode-slide><h2 id=good-faith-policy>Good Faith Policy</h2><blockquote><p>&ldquo;These courses expects a high standard of professionalism from its students with regard to how security testing is conducted. We expect all students to act in good faith at all times [&mldr;]&rdquo;</p></blockquote><p>TL;DR Don&rsquo;t be mean</p><p><a href=https://sec.edu.au/good-faith-policy>https://sec.edu.au/good-faith-policy</a></p></section><section data-noprocess data-shortcode-slide class=center><h1 id=content-review>Content Review</h1></section><section><h2 id=assembly>Assembly</h2><p>Your common assembly instructions</p><pre><code class=language-bash>mov a, b        # a = b
add a, value    # a = a + value
sub a, value    # a = a - value
xor a, b        # a = a ^ b
and a, b        # a = a &amp; b
push a          # push a onto the stack, then dec esp - 4
pop a           # pop into a from the stack, then add esp + 4
int 0x80        # syscall
</code></pre><p>¬†</p><h2 id=syscalls>Syscalls</h2><p><a href=https://featherbear.cc/UNSW-COMP6447/syscall>Syscall Table</a></p></section><section><h2 id=cdecl>cdecl</h2><blockquote><p>void mycoolfunc(char *a, int b, char *c)</p></blockquote><p>What assembly would I write to call this function?</p><ul><li><span class=fragment><code>push address_c</code></span></li><li><span class=fragment><code>push value_b</code></span></li><li><span class=fragment><code>push address_a</code></span></li><li><span class=fragment><code>call mycoolfunc</code></span></li></ul></section><section><h2 id=shellcode-tldr>Shellcode TL;DR</h2><section data-shortcode-section><p>Shellcode is a sequence of assembly instructions that carry out a task. If we can make the instruction pointer (<code>EIP</code>) point to our shellcode, we have code execution!</p><ul><li>Functions are just assembly</li><li>Assembly are just bytes</li><li>We can send bytes :)</li></ul><p>Generally we want to pop a <em>shell</em></p></section><section><h3 id=demo>Demo</h3><blockquote><p><code>./runner</code></p></blockquote></section></section><section><h2 id=-egghunter>ü•ö Egghunter</h2><section data-shortcode-section><p>Sometimes we do not have enough space in an execute-vulnerable buffer to inject our payload.</p><p>Instead, we put our payload (the egg) somewhere else, and write an &lsquo;egg hunter&rsquo; - assembly instructions that finds and execute the egg.</p></section><section><h4 id=my-little-pwn-y>My Little Pwn-y</h4><p>Demo time!</p><div style=font-size:.73em><pre><code class=language-c>#include &lt;stdio.h&gt;   // Compile with:
#include &lt;stdlib.h&gt;  //   gcc -o eggHunterDemo -z execstack -m32 -g eggHunterDemo.c
#include &lt;time.h&gt;    //                        \__________/
#include &lt;unistd.h&gt;  // -- Andrew                   | allow stack execution

int main() {
    char mem[256] = { 0 }, shellcode[512] = { 0 };
    srand(time(NULL));

    // Set some random position in mem to [0, 255]
    mem[(u_int8_t)rand()] = 0xFF;  // eggu desu ~

    puts(&quot;Find that egg!\nEnter up to 512 bytes of shellcode&quot;);
    read(0, shellcode, 512);
    // Your shellcode should accept a buffer (esp+4), and return an index via eax
    u_int8_t i = ((u_int8_t(*)(u_int8_t * a)) shellcode)(mem);

    printf(&quot;mem[i = %hhu] = 0x%2x\n&quot;, i, mem[i] &amp; 0xFF);
    puts(mem[i] &amp; 0xFF == 0xFF ? &quot;nice!&quot; : &quot;nope.&quot;);
}
</code></pre></div></section></section><section><h2 id=-omelette-egghunter>üç≥ Omelette Egghunter</h2><p>A fancy egghunter that finds multiple payloads / eggs and combines them together.</p><p><img src=gudetama.png style=margin:0;border:0;background:initial;box-shadow:none></p><p>Useful when we have <em>multiple</em> regions of controllable memory that can collectively hold the entire payload.</p></section><section><h2 id=binsh><code>/bin/////////sh</code></h2><p>Sometimes we cannot inject <code>/bin/sh</code> directly.</p><section data-shortcode-section><blockquote><p>Why?</p></blockquote><ul><li>An input parser that stops after the <code>NULL</code> character<ul><li><em>How do we check if we are at the end of a string?</em></li></ul></li><li>An input sanitiser that removes the <code>NULL</code> character</li></ul><pre><code>                                      !! uh oh, null char!
                                      vv
_hs/ | push 0x0068732f | 68 2f 73 68 [00]
nib/ | push 0x6e69622f | 68 2f 62 69  6e 
</code></pre></section><section><blockquote><p>We have ways around this!</p></blockquote><p>Pad our <code>/bin/sh</code> to <code>/bin//sh</code></p><pre><code class=language-bash>// BEFORE
_hs/ | push 0x0068732f | 68 2f 73 68 00
nib/ | push 0x6e69622f | 68 2f 62 69 6e
</code></pre><pre><code class=language-bash>// AFTER
hs// | push 0x68732f2f | 68 2f 2f 73 68
nib/ | push 0x6e69622f | 68 2f 62 69 6e
</code></pre></section><section><pre><code class=language-bash>some shellcode yadda yadda / b i n / / s h ... int 0x80 
</code></pre><blockquote><p>How do we push <code>0</code>'s onto the stack?</p></blockquote><p><code>xor eax, eax</code><br><code>push eax</code></p><p>etc&mldr;</p></section><section><blockquote><p>Sometime in the future&mldr;</p></blockquote><p>Maybe <code>/bin/sh</code> is already in the program???</p><p>¬†</p><p>idk <code>¬Ø\_(„ÉÑ)_/¬Ø</code></p></section></section><section><h2 id=nopsleds>NOPsleds</h2><section data-shortcode-section><p>NOP NOP NOP NOP NOP NOP NOP NOP NOP NOP NOP<br>NOP NOP NOP NOP NOP NOP NOP NOP NOP NOP NOP<br>NOP NOP NOP NOP NOP NOP NOP NOP NOP NOP NOP<br>NOP NOP NOP NOP NOP NOP NOP NOP NOP NOP NOP<br>NOP NOP NOP NOP NOP NOP NOP NOP NOP NOP NOP<br>NOP NOP NOP NOP NOP NOP NOP NOP NOP NOP NOP<br>NOP NOP NOP NOP NOP NOP NOP NOP NOP NOP NOP<br>NOP NOP NOP NOP NOP NOP NOP NOP NOP NOP NOP<br>NOP NOP NOP NOP NOP NOP NOP NOP NOP NOP NOP</p></section><section><p>In order to execute our shellcode, we need to know the exact start address of it&mldr; sometimes we can&rsquo;t do that, but we can jump near it and <code>nop</code>-sled away.</p><blockquote><p>The <code>nop</code> instruction (<code>\x90</code>) is a <strong>single byte</strong> instruction that does nothing</p></blockquote><pre><code class=language-bash>Where we start execution      Where our shellcode actually is
|                             |
v                             v 
\x90 \x90 \x90 \x90 \x90 \x90 \x68 \x2f \x2f \x73 \x68 \x68..
</code></pre></section></section><section><h1 id=activities>Activities</h1><blockquote><p>Lab 2 - Shellcode Exercices</p></blockquote></section></div></div><script type=text/javascript src=../reveal-hugo/object-assign.js></script><a href=../reveal-js/css/print/ id=print-location style=display:none></a><script type=text/javascript>var printLocationElement=document.getElementById('print-location');var link=document.createElement('link');link.rel='stylesheet';link.type='text/css';link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?'pdf.css':'paper.css');document.getElementsByTagName('head')[0].appendChild(link);</script><script type=application/json id=reveal-hugo-site-params>{"center":false,"history":true,"pdf_separate_fragments":false,"slide_number":true}</script><script type=application/json id=reveal-hugo-page-params>null</script><script src=../reveal-js/js/reveal.js></script><script type=text/javascript>function camelize(map){if(map){Object.keys(map).forEach(function(k){newK=k.replace(/(\_\w)/g,function(m){return m[1].toUpperCase()});if(newK!=k){map[newK]=map[k];delete map[k];}});}
return map;}
var revealHugoDefaults={center:true,controls:true,history:true,progress:true,transition:"slide"};var revealHugoSiteParams=JSON.parse(document.getElementById('reveal-hugo-site-params').innerHTML);var revealHugoPageParams=JSON.parse(document.getElementById('reveal-hugo-page-params').innerHTML);var options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams));Reveal.initialize(options);</script><script type=text/javascript src=../reveal-js/plugin/markdown/marked.js></script><script type=text/javascript src=../reveal-js/plugin/markdown/markdown.js></script><script type=text/javascript src=../reveal-js/plugin/highlight/highlight.js></script><script type=text/javascript src=../reveal-js/plugin/zoom-js/zoom.js></script><script type=text/javascript src=../reveal-js/plugin/notes/notes.js></script><script type=text/javascript>document.title+=" | COMP6447 Tutorial Slides";window.MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]},svg:{fontCache:'global'}};</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js></script><script>if(window.location.search.match(/\?print-pdf/gi)){function insertCSS(src){const link=document.createElement('link');link.rel='stylesheet';link.type='text/css';link.href=src;document.getElementsByTagName('head')[0].appendChild(link);}
insertCSS('\/reveal-js\/css\/print\/pdf.css');insertCSS('\/hideHomeButton.css');}</script><a id=homeButton style=position:fixed;bottom:8px;left:8px;z-index:31;font-family:Helvetica,sans-serif;font-size:12px;line-height:1;color:#fff;background-color:rgba(0,0,0,.4);padding:5px;text-decoration:none href=../>Home</a></body></html>